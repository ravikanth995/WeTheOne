<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tamarind Seed Race</title>
  <style>
    :root {
      --bg: #f5ecd7;
      --ink: #2a2118;
      --line: #5c4932;
      --home: #c8913b;
      --safe: #5aa469;
      --card: #fff9ed;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--ink);
      background: radial-gradient(circle at top, #fff8e9 0%, var(--bg) 60%);
    }
    .app {
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px;
      display: grid;
      gap: 16px;
      grid-template-columns: minmax(320px, 700px) minmax(250px, 1fr);
    }
    @media (max-width: 930px) { .app { grid-template-columns: 1fr; } }

    .board-wrap, .panel {
      background: var(--card);
      border: 2px solid #cab189;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    }
    .board-wrap { padding: 14px; }
    h1 { margin: 4px 0 8px; font-size: 1.35rem; }
    .subtitle { margin: 0 0 10px; font-size: 0.92rem; }
    svg { width: 100%; height: auto; display: block; }

    .panel { padding: 14px; }
    .row { margin-bottom: 10px; }
    .seed-row {
      display: flex; gap: 8px; margin: 10px 0;
      min-height: 34px;
    }
    .seed {
      width: 28px; height: 28px;
      border-radius: 50%;
      border: 2px solid #6c5539;
      display: grid; place-items: center;
      font-weight: 700;
      background: #2f2318;
      color: #f8f8f8;
    }
    .seed.white { background: #f3efe6; color: #2f2318; }

    button {
      border: none;
      background: #8f6026;
      color: #fff;
      padding: 10px 14px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
    }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    ul { padding-left: 18px; margin: 8px 0 0; }
    .token-btns { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
    .token-btns button { background: #30446b; }
    .small { font-size: 0.85rem; opacity: 0.9; }
    .legend-dot {
      width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 6px;
      border: 1px solid rgba(0,0,0,0.25);
    }
  </style>
</head>
<body>
  <div class="app">
    <section class="board-wrap">
      <h1>Tamarind Seed Cross Race</h1>
      <p class="subtitle">Throw 4 split tamarind seeds (white/dark). Move by white count. If all dark, move 8.</p>
      <svg viewBox="0 0 700 700" id="board" aria-label="Game board"></svg>
    </section>

    <aside class="panel">
      <div class="row"><strong id="turnText">Turn: Red</strong></div>
      <div class="row">Last throw: <strong id="rollText">—</strong></div>
      <div class="seed-row" id="seedRow"></div>
      <button id="rollBtn">Throw Seeds</button>
      <div class="token-btns" id="moveButtons"></div>
      <p class="small" id="status">Throw seeds to start.</p>
      <hr>
      <div class="small">
        <p><strong>Rules:</strong></p>
        <ul>
          <li>4 seeds are thrown each turn: white side count = steps (1–4).</li>
          <li>If all 4 are dark, you move <strong>8</strong> steps.</li>
          <li>Landing on an opponent sends that token back to start.</li>
          <li>Diagonal safe points cannot be captured.</li>
          <li>Roll of 4 or 8 grants an extra turn.</li>
          <li>Get both your tokens to center home to win.</li>
        </ul>
      </div>
      <hr>
      <div class="small">
        <div><span class="legend-dot" style="background:#db4f4f"></span>Red</div>
        <div><span class="legend-dot" style="background:#4774d4"></span>Blue</div>
        <div><span class="legend-dot" style="background:#4baf5f"></span>Green</div>
        <div><span class="legend-dot" style="background:#e0ad3a"></span>Yellow</div>
      </div>
    </aside>
  </div>

<script>
const svg = document.getElementById('board');
const rollBtn = document.getElementById('rollBtn');
const moveButtons = document.getElementById('moveButtons');
const turnText = document.getElementById('turnText');
const rollText = document.getElementById('rollText');
const seedRow = document.getElementById('seedRow');
const statusText = document.getElementById('status');

const cell = 52;
const offset = 64;
const track = [];
const safeIndices = new Set([0, 8, 16, 24]);

for (let c = 0; c < 8; c++) track.push([c, 0]);
for (let r = 1; r < 8; r++) track.push([7, r]);
for (let c = 6; c >= 0; c--) track.push([c, 7]);
for (let r = 6; r >= 1; r--) track.push([0, r]);

const center = [3.5, 3.5];
const players = [
  { name: 'Red', color: '#db4f4f', start: 0 },
  { name: 'Blue', color: '#4774d4', start: 8 },
  { name: 'Green', color: '#4baf5f', start: 16 },
  { name: 'Yellow', color: '#e0ad3a', start: 24 },
];

let state = {
  turn: 0,
  roll: null,
  tokens: players.map((p, pi) => [
    { player: pi, pos: 0, id: 0 },
    { player: pi, pos: 0, id: 1 },
  ]),
  winner: null,
};

function toXY(point) {
  const [c, r] = point;
  return [offset + c * cell + cell / 2, offset + r * cell + cell / 2];
}

function tokenPoint(token) {
  if (token.pos <= 0) return toXY(track[players[token.player].start]);
  if (token.pos >= 33) return toXY(center);
  const idx = (players[token.player].start + token.pos - 1) % 28;
  return toXY(track[idx]);
}

function create(tag, attrs = {}) {
  const el = document.createElementNS('http://www.w3.org/2000/svg', tag);
  Object.entries(attrs).forEach(([k, v]) => el.setAttribute(k, v));
  return el;
}

function drawBoard() {
  svg.innerHTML = '';
  svg.appendChild(create('rect', { x: 30, y: 30, width: 640, height: 640, rx: 20, fill: '#efe1c7', stroke: '#6f5a3b', 'stroke-width': 3 }));

  track.forEach((p, i) => {
    const [x, y] = toXY(p);
    svg.appendChild(create('rect', {
      x: x - cell / 2 + 2, y: y - cell / 2 + 2,
      width: cell - 4, height: cell - 4,
      fill: safeIndices.has(i) ? '#cbe7d0' : '#fff4df',
      stroke: '#8b7351', 'stroke-width': 1.5,
    }));
    if (safeIndices.has(i)) {
      svg.appendChild(create('circle', { cx: x, cy: y, r: 6, fill: '#2f8f45' }));
    }
  });

  const [cx, cy] = toXY(center);
  svg.appendChild(create('circle', { cx, cy, r: 70, fill: '#d7ad62', stroke: '#6f5a3b', 'stroke-width': 3 }));
  const txt = create('text', { x: cx, y: cy + 6, 'text-anchor': 'middle', 'font-size': 20, 'font-weight': 700, fill: '#3b2c17' });
  txt.textContent = 'HOME';
  svg.appendChild(txt);

  const groups = {};
  state.tokens.flat().forEach((tok) => {
    const key = tok.pos <= 0
      ? `start-${tok.player}`
      : tok.pos >= 33
        ? 'home'
        : `tile-${(players[tok.player].start + tok.pos - 1) % 28}`;
    groups[key] ??= [];
    groups[key].push(tok);
  });

  Object.values(groups).forEach((tokensAt) => {
    tokensAt.forEach((tok, idx) => {
      const [x, y] = tokenPoint(tok);
      const angle = (Math.PI * 2 * idx) / Math.max(tokensAt.length, 1);
      const ox = Math.cos(angle) * 12;
      const oy = Math.sin(angle) * 12;
      svg.appendChild(create('circle', {
        cx: x + ox, cy: y + oy, r: 12,
        fill: players[tok.player].color,
        stroke: '#1f1f1f', 'stroke-width': 2,
      }));
      const t = create('text', { x: x + ox, y: y + oy + 4, 'text-anchor': 'middle', 'font-size': 10, 'font-weight': 700, fill: '#fff' });
      t.textContent = tok.id + 1;
      svg.appendChild(t);
    });
  });
}

function throwSeeds() {
  const faces = Array.from({ length: 4 }, () => Math.random() > 0.5 ? 'white' : 'dark');
  const whites = faces.filter(f => f === 'white').length;
  const steps = whites === 0 ? 8 : whites;
  return { faces, steps };
}

function canMove(token, steps) {
  return token.pos < 33 && steps > 0;
}

function movableTokens() {
  if (!state.roll) return [];
  return state.tokens[state.turn]
    .map((t, i) => ({ token: t, i }))
    .filter(({ token }) => token.pos < 33 && canMove(token, state.roll.steps));
}

function updateUI() {
  if (state.winner !== null) {
    turnText.textContent = `Winner: ${players[state.winner].name}`;
    rollBtn.disabled = true;
    moveButtons.innerHTML = '';
    drawBoard();
    return;
  }

  turnText.textContent = `Turn: ${players[state.turn].name}`;
  rollText.textContent = state.roll ? `${state.roll.steps} steps` : '—';

  seedRow.innerHTML = '';
  if (state.roll) {
    state.roll.faces.forEach((f, i) => {
      const d = document.createElement('div');
      d.className = `seed ${f === 'white' ? 'white' : ''}`;
      d.textContent = i + 1;
      seedRow.appendChild(d);
    });
  }

  moveButtons.innerHTML = '';
  if (state.roll) {
    const moves = movableTokens();
    if (!moves.length) {
      statusText.textContent = 'No valid move. Turn passes.';
      setTimeout(nextTurn, 700);
    } else {
      statusText.textContent = 'Choose a token to move.';
      moves.forEach(({ i }) => {
        const b = document.createElement('button');
        b.textContent = `Move Token ${i + 1}`;
        b.onclick = () => performMove(i);
        moveButtons.appendChild(b);
      });
    }
  } else {
    statusText.textContent = 'Throw seeds to play.';
  }

  rollBtn.disabled = Boolean(state.roll);
  drawBoard();
}

function performMove(tokenIndex) {
  const token = state.tokens[state.turn][tokenIndex];
  token.pos += state.roll.steps;
  if (token.pos > 33) token.pos = 33;

  if (token.pos < 33) {
    const tile = (players[token.player].start + token.pos - 1) % 28;
    if (!safeIndices.has(tile)) {
      state.tokens.forEach((arr, pi) => {
        if (pi === state.turn) return;
        arr.forEach((t) => {
          if (t.pos < 33) {
            const tTile = (players[t.player].start + t.pos - 1) % 28;
            if (tTile === tile) t.pos = 0;
          }
        });
      });
    }
  }

  const mine = state.tokens[state.turn];
  if (mine.every(t => t.pos >= 33)) {
    state.winner = state.turn;
    updateUI();
    return;
  }

  const grantExtra = state.roll.steps === 4 || state.roll.steps === 8;
  state.roll = null;
  if (!grantExtra) state.turn = (state.turn + 1) % players.length;
  updateUI();
}

function nextTurn() {
  if (state.winner !== null) return;
  state.roll = null;
  state.turn = (state.turn + 1) % players.length;
  updateUI();
}

rollBtn.addEventListener('click', () => {
  state.roll = throwSeeds();
  updateUI();
});

updateUI();
</script>
</body>
</html>
